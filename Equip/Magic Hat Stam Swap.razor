if not timerexists hatSwapTimer
    createtimer hatSwapTimer
endif

if timer hatSwapTimer > 5000
    overhead '[hat swapping]' 54
    settimer hatSwapTimer 0
endif

if not varexist currentHat or not find currentHat self
    overhead 'Select your headwear:' 54
    setvar currentHat
endif

if diffstam = 0 and findtype "wizard's hat" backpack as hat
    dclick hat
    wait 650
    
    if find currentHat backpack as prevHat
        dclick prevHat
    endif
endif

loop