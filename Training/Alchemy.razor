# Training Sullivahn for GM Alchemy

# ----------------------------
# Prechecks for resources

if not findtype 'empty bottle%s%' backpack
    if findtype 'empty bottle%s%' 0x4B6FA8C9 as bottles
        overhead 'Restocking bottles...'
        lift bottles 25
        drop backpack 0 0 0
    else
        overhead 'No more bottles' 38
    endif
endif

if not findtype 'mortar and pestle' backpack
    overhead 'Missing mortar and pestle!' 38
    wait 5000
    loop
endif

# Lesser Poison
if skill 'Alchemy' < 55
    if not findtype 'Nightshade'
        overhead 'Missing nightshade!' 38
        wait 5000
        loop
    endif

# Lesser Magic Resist
elseif skill 'Alchemy' < 75
    if counttype "Spider's Silk" backpack < 4
        overhead 'Missing spider silk!' 38
        wait 5000
        loop
    endif

# Greater Poison
elseif skill 'Alchemy' < 95

# Deadly Poison
elseif skill 'Alchemy' < 115

# Lethal Poison
elseif skill 'Alchemy' < 120

# Lesser Magic Resist
else   
    overhead "Legendary Poisoner!"
endif


# ----------------------------
# Do the Alchemy
gumpclose 
dclicktype "mortar and pestle" backpack
waitforgump 949095101

# Lesser Poison
if skill 'Alchemy' < 55
    overhead '50 - 55: Lesser Poison'
    gumpresponse 106
    waitforgump 949095101
    gumpresponse 200
    waitforgump 949095101
  
# Poison option for training.  
#elseif skill 'Alchemy' < 75
#    overhead '55 - 75: Regular Poison'
#    gumpresponse 106
#    waitforgump 949095101
#    gumpresponse 201
#    waitforgump 949095101
    
# Lesser Magic Resist
elseif skill 'Alchemy' < 75
    overhead '55 - 75: Lesser Magic Resist'
    gumpresponse 105
    waitforgump 949095101
    gumpresponse 200
    waitforgump 949095101
    
    # chug, chug, chug! 
    # use em up for the bottles
    if counttype 'Black Potion' >= 25
        while findtype 'Black Potion' backpack as potion
            dclick potion 
        endwhile
    endif

# Greater Poison
elseif skill 'Alchemy' < 95
    overhead '75 - 95: Greater Poison'
    gumpresponse 106
    waitforgump 949095101
    gumpresponse 202
    waitforgump 949095101
    
# Deadly Poison
elseif skill 'Alchemy' < 115
    overhead '95 - 115: Deadly Poison'
    gumpresponse 106
    waitforgump 949095101
    gumpresponse 203
    waitforgump 949095101
    
# Lethal Poison
elseif skill 'Alchemy' < 120
    overhead '115 - 120: Lethal Poison'
    gumpresponse 106
    waitforgump 949095101
    gumpresponse 204
    waitforgump 949095101

# Done
else   
    overhead "Legendary Poisoner!"
endif

wait 2500

# ----------------------------
# Move potion to the chest
while counttype 'Green Potion' self >= 24 and findtype 'Green Potion' backpack as potion 
    overhead 'moving potions...'    
    lift potion 25

#    if findtype 'Green Potion' 0x4B6FA8C9 as stack
#        # add emptle bottles to the existing stack
#        drop stack
#    else
        # add a new stack in the chest
        drop 0x4B6FA8C9 76 151 0
        #    endif

endwhile

loop