if not varexist currentHat or not find currentHat self
    overhead 'Select your headwear:' 54
    setvar currentHat
endif

if skill 'meditation' == 100
    setskill 'meditation' lock
    stop
endif

if diffmana = 0
    if findtype "wizard's hat" backpack as hat
        dclick hat
        wait 650
        
        while diffmana > 0
            skill 'meditation'
        endwhile
        
        dclick currentHat
        wait 650
    endif
endif

loop